/* Table hôtels */
CREATE OR REPLACE TABLE HOTELS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
NAME VARCHAR(30) NOT NULL,
STREET VARCHAR(50) NOT NULL,
CITY VARCHAR(30) NOT NULL,
STAR_RATING INTEGER UNSIGNED NOT NULL,
CHECK (STAR_RATING > 0 AND STAR_RATING <= 5),
PRIMARY KEY (ID));

/* Table clients */
CREATE OR REPLACE TABLE CLIENTS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
FIRSTNAME VARCHAR(30) NOT NULL,
LASTNAME VARCHAR(30) NOT NULL,
STREET VARCHAR(30) NOT NULL,
CITY VARCHAR(30) NOT NULL,
MAIL VARCHAR(30) NOT NULL UNIQUE,
PASSWORD VARCHAR(200) NOT NULL,
IS_REGULAR BOOLEAN DEFAULT 0 NOT NULL,
PRIMARY KEY (ID));

/* Table types de chambre */
CREATE OR REPLACE TABLE ROOMTYPES (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
NAME VARCHAR(30) NOT NULL,
PRICE DECIMAL(6,2) UNSIGNED NOT NULL,
BED_CAPACITY INTEGER UNSIGNED NOT NULL,
HAS_PHONE BOOLEAN NOT NULL,
HAS_TV BOOLEAN NOT NULL,
CHECK (PRICE > 0),
PRIMARY KEY (ID));

/* Table chambres */
CREATE OR REPLACE TABLE ROOMS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
HOTEL_ID INTEGER UNSIGNED,
ROOMTYPE_ID INTEGER UNSIGNED NOT NULL,
PRIMARY KEY (ID),
FOREIGN KEY (HOTEL_ID) REFERENCES HOTELS(ID),
FOREIGN KEY (ROOMTYPE_ID) REFERENCES ROOMTYPES(ID));

/* Table réservations */
CREATE OR REPLACE TABLE RESERVATIONS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
CLIENT_ID INTEGER UNSIGNED,
HOTEL_ID INTEGER UNSIGNED,
ROOMTYPE_ID INTEGER UNSIGNED,
ARRIVAL_DATE TIMESTAMP(0) DEFAULT 0 NOT NULL,
EXIT_DATE TIMESTAMP(0) DEFAULT 0 NOT NULL,
DURATION INTEGER UNSIGNED NOT NULL,
CHECK (DURATION > 0),
ROOM_COUNT INTEGER UNSIGNED NOT NULL,
CHECK (ROOM_COUNT > 0),
PEOPLE_COUNT INTEGER UNSIGNED NOT NULL,
CHECK (PEOPLE_COUNT > 0),
IS_PAYED BOOLEAN DEFAULT 0 NOT NULL,
IS_COMFIRMED BOOLEAN DEFAULT 0 NOT NULL,
IS_CANCELLED BOOLEAN DEFAULT 0 NOT NULL,
IS_ARCHIVED BOOLEAN DEFAULT 0 NOT NULL,
PRIMARY KEY (ID),
FOREIGN KEY (CLIENT_ID) REFERENCES CLIENTS(ID),
FOREIGN KEY (HOTEL_ID) REFERENCES HOTELS(ID),
FOREIGN KEY (ROOMTYPE_ID) REFERENCES ROOMTYPES(ID));

/* Table occupations */
CREATE OR REPLACE TABLE OCCUPATIONS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE,
RESERVATION_ID INTEGER UNSIGNED,
ROOM_ID INTEGER UNSIGNED,
IS_CLIENT_PRESENT BOOLEAN DEFAULT 0 NOT NULL,
IS_ARCHIVED BOOLEAN DEFAULT 0 NOT NULL,
PRIMARY KEY (RESERVATION_ID, ROOM_ID),
FOREIGN KEY (RESERVATION_ID) REFERENCES RESERVATIONS(ID),
FOREIGN KEY (ROOM_ID) REFERENCES ROOMS(ID));

/* Table occupants */
CREATE OR REPLACE TABLE OCCUPANTS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE,
OCCUPATION_ID INTEGER UNSIGNED,
FIRSTNAME VARCHAR(30) NOT NULL,
LASTNAME VARCHAR(30) NOT NULL,
PRIMARY KEY (OCCUPATION_ID, FIRSTNAME, LASTNAME),
FOREIGN KEY (OCCUPATION_ID) REFERENCES OCCUPATIONS(ID));

/* Table services */
CREATE OR REPLACE TABLE SERVICES (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE,
HOTEL_ID INTEGER UNSIGNED,
NAME VARCHAR(30) NOT NULL UNIQUE,
PRICE DECIMAL(6,2) UNSIGNED NOT NULL,
UNIQUE_ORDER BOOLEAN NOT NULL,
PRIMARY KEY (HOTEL_ID, NAME),
FOREIGN KEY (HOTEL_ID) REFERENCES HOTELS(ID));

/* Table factures */
CREATE OR REPLACE TABLE BILLS (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE,
RESERVATION_ID INTEGER UNSIGNED NOT NULL,
CLIENT_ID INTEGER UNSIGNED NOT NULL,
AMOUNT DECIMAL(8,2) NOT NULL,
IS_PAYED BOOLEAN DEFAULT 0 NOT NULL,
IS_ARCHIVED BOOLEAN DEFAULT 0 NOT NULL,
PRIMARY KEY (RESERVATION_ID,CLIENT_ID),
FOREIGN KEY (RESERVATION_ID) REFERENCES RESERVATIONS(ID),
FOREIGN KEY (CLIENT_ID) REFERENCES CLIENTS(ID));

/* Table des services facturés */
CREATE OR REPLACE TABLE BILLEDSERVICES (
ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
OCCUPATION_ID INTEGER UNSIGNED NOT NULL,
SERVICE_ID INTEGER UNSIGNED NOT NULL,
IS_ARCHIVED BOOLEAN DEFAULT 0 NOT NULL,
PRIMARY KEY (ID),
FOREIGN KEY (OCCUPATION_ID) REFERENCES OCCUPATIONS(ID),
FOREIGN KEY (SERVICE_ID) REFERENCES SERVICES(ID));

/* INSERTION DES TYPES DE CHAMBRE PAR DÉFAUT */
INSERT INTO ROOMTYPES(ID,NAME,PRICE,BED_CAPACITY,HAS_PHONE,HAS_TV) VALUES (1,'STANDARD','49.99',1,0,0);
INSERT INTO ROOMTYPES(ID,NAME,PRICE,BED_CAPACITY,HAS_PHONE,HAS_TV) VALUES (2,'TOURISM','79.99',1,0,1);
INSERT INTO ROOMTYPES(ID,NAME,PRICE,BED_CAPACITY,HAS_PHONE,HAS_TV) VALUES (3,'COMFORT','119.99',2,0,1);
INSERT INTO ROOMTYPES(ID,NAME,PRICE,BED_CAPACITY,HAS_PHONE,HAS_TV) VALUES (4,'LUXURY','299.99',3,1,1);

/* INSERTION DES HOTELS DISPONIBLES */
INSERT INTO HOTELS(ID,NAME,STREET,CITY,STAR_RATING) VALUES (1,"IBIS BUSINESS","45 avenue du Four","Marseille",3);
INSERT INTO HOTELS(ID,NAME,STREET,CITY,STAR_RATING) VALUES (2,"IBIS CLASSIC","3 rue Mauvais","Paris",4);
INSERT INTO HOTELS(ID,NAME,STREET,CITY,STAR_RATING) VALUES (3,"IBIS LUXE","12 avenue de la Fleur","Nice",5);

/* INSERTION DES CHAMBRES DISPONIBLES */
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (1,1);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (1,1);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (1,2);

INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (2,2);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (2,2);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (2,3);

INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (3,4);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (3,4);
INSERT INTO ROOMS(HOTEL_ID,ROOMTYPE_ID) VALUES (3,4);

/* INSERTION DES SERVICES DE CHAQUE HOTEL */
INSERT INTO SERVICES(HOTEL_ID,NAME,PRICE,UNIQUE_ORDER) VALUES (1,"Télévision","19.99",1);

INSERT INTO SERVICES(HOTEL_ID,NAME,PRICE,UNIQUE_ORDER) VALUES (2,"Téléphone fixe","19.99",1);
INSERT INTO SERVICES(HOTEL_ID,NAME,PRICE,UNIQUE_ORDER) VALUES (2,"Petit déjeuner","9.99",0);

INSERT INTO SERVICES(HOTEL_ID,NAME,PRICE,UNIQUE_ORDER) VALUES (3,"Petit déjeuner volonté","29.99",0);
INSERT INTO SERVICES(HOTEL_ID,NAME,PRICE,UNIQUE_ORDER) VALUES (3,"Cocktails à volonté","59.99",1);


/* INSERTION DES CLIENTS */
INSERT INTO CLIENTS(FIRSTNAME,LASTNAME,STREET,CITY,MAIL,PASSWORD,IS_REGULAR) VALUES ("HERCULE","Bertrand","34 rue Mangeons","Toulouse","hercule-b@gmail.com","herculeb",0);
INSERT INTO CLIENTS(FIRSTNAME,LASTNAME,STREET,CITY,MAIL,PASSWORD,IS_REGULAR) VALUES ("MONTROI","Paul","3 avenue des Voitures","Grenoble","montroi-p@gmail.com","montroip",0);
INSERT INTO CLIENTS(FIRSTNAME,LASTNAME,STREET,CITY,MAIL,PASSWORD,IS_REGULAR) VALUES ("RONPUI","Henri","89 rue du Pigeon","Lille","ronpui-h@gmail.com","ronpuih",1);